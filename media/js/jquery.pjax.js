(function(a){function b(b,c,e){e=d(c,e);var f=b.currentTarget;if(b.which>1||b.metaKey)return;if(location.protocol!==f.protocol||location.host!==f.host)return;if(f.hash&&f.href.replace(f.hash,"")===location.href.replace(location.hash,""))return;var g={url:f.href,container:a(f).attr("data-pjax"),clickedElement:a(f),fragment:null};return a.pjax(a.extend({},g,e)),b.preventDefault(),!1}function d(b,c){return b&&c?c.container=b:a.isPlainObject(b)?c=b:c={container:b},c.container&&(c.container=e(c.container)),c}function e(b){b=a(b);if(!b.length)throw"no pjax container for "+b.selector;if(b.selector!==""&&b.context===document)return b;if(b.attr("id"))return a("#"+b.attr("id"));throw"cant get selector for pjax container!"}a.fn.pjax=function(a,c){return c=d(a,c),this.live("click",function(a){return b(a,c)})};var c=a.pjax=function(b){var d=e(b.container),f=b.success||a.noop;delete b.success,b=a.extend(!0,{},c.defaults,b),a.isFunction(b.url)&&(b.url=b.url()),b.context=d,b.success=function(e){if(b.fragment){var g=a(e).find(b.fragment);if(!g.length)return window.location=b.url;e=g.children()}else if(!a.trim(e)||/<html/i.test(e))return window.location=b.url;this.html(e);var h=document.title,i=a.trim(this.find("title").remove().text());!i&&b.fragment&&(i=g.attr("title")||g.data("title")),i&&(document.title=i);var j={pjax:d.selector,fragment:b.fragment,timeout:b.timeout},k=a.param(b.data);k!="_pjax=true"&&(j.url=b.url+(/\?/.test(b.url)?"&":"?")+k),b.replace?(c.active=!0,window.history.replaceState(j,document.title,b.url)):b.push&&(c.active||(window.history.replaceState(a.extend({},j,{url:null}),h),c.active=!0),window.history.pushState(j,document.title,b.url)),(b.replace||b.push)&&window._gaq&&_gaq.push(["_trackPageview"]);var l=window.location.hash.toString();l!==""&&(window.location.href=l),f.apply(this,arguments)};var g=c.xhr;return g&&g.readyState<4&&(g.onreadystatechange=a.noop,g.abort()),c.options=b,c.xhr=a.ajax(b),a(document).trigger("pjax",[c.xhr,b]),c.xhr},f=null;c.defaults={timeout:650,push:!0,replace:!1,data:{_pjax:!0},type:"GET",dataType:"html",beforeSend:function(b,d){var e=this;d.async&&d.timeout>0&&(f=setTimeout(function(){var d=a.Event("pjax:timeout");e.trigger(d,[b,c.options]),d.result!==!1&&b.abort("timeout")},d.timeout),d.timeout=0),this.trigger("pjax:start",[b,c.options]),this.trigger("start.pjax",[b,c.options]),b.setRequestHeader("X-PJAX","true")},error:function(a,b,d){b!=="abort"&&(window.location=c.options.url)},complete:function(a){f&&clearTimeout(f),this.trigger("pjax:end",[a,c.options]),this.trigger("end.pjax",[a,c.options])}},c.click=b;var g="state"in window.history,h=location.href;a(window).bind("popstate",function(b){var c=!g&&location.href==h;g=!0;if(c)return;var d=b.state;if(d&&d.pjax){var e=d.pjax;a(e+"").length?a.pjax({url:d.url||location.href,fragment:d.fragment,container:e,push:!1,timeout:d.timeout}):window.location=location.href}}),a.inArray("state",a.event.props)<0&&a.event.props.push("state"),a.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/),a.support.pjax||(a.pjax=function(b){window.location=a.isFunction(b.url)?b.url():b.url},a.pjax.click=a.noop,a.fn.pjax=function(){return this})})(jQuery);